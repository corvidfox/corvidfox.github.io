<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Morrigan M.">
<meta name="dcterms.date" content="2025-06-30">
<meta name="description" content="This project explores the Chinook dataset — a mock digital music store — to uncover key business insights around revenue, customers, and performance. It combines SQL analysis with dashboard development to present findings visually.">

<title>SQL-Driven Business Intelligence Dashboard (Chinook ‘Digital Music Store’) – Data Science &amp; Bioinformatics Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href=".././img/favicon-32x32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-a8daa347c29f3bce361fb1b75b940d3b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-ca131377d38971f765fa5a67f280c60e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-a8daa347c29f3bce361fb1b75b940d3b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="../site_libs/plotly-binding-4.11.0/plotly.js"></script>

<script src="../site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="../site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>



</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Data Science &amp; Bioinformatics Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/corvidfox"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">GitHub</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/morrigan-mahady-6b640712b"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text">LinkedIn</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="mailto:anmorrigan@proton.me"> <i class="bi bi-envelope-at-fill" role="img">
</i> 
<span class="menu-text">Email</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#project-overview" id="toc-project-overview" class="nav-link active" data-scroll-target="#project-overview">Project Overview</a>
  <ul class="collapse">
  <li><a href="#technology-stack" id="toc-technology-stack" class="nav-link" data-scroll-target="#technology-stack">Technology Stack</a></li>
  <li><a href="#business-questions" id="toc-business-questions" class="nav-link" data-scroll-target="#business-questions">Business Questions</a></li>
  </ul></li>
  <li><a href="#data-exploration-schema-understanding" id="toc-data-exploration-schema-understanding" class="nav-link" data-scroll-target="#data-exploration-schema-understanding">Data Exploration &amp; Schema Understanding</a>
  <ul class="collapse">
  <li><a href="#connection-and-validation" id="toc-connection-and-validation" class="nav-link" data-scroll-target="#connection-and-validation">Connection and Validation</a></li>
  </ul></li>
  <li><a href="#question-1-where-is-revenue-coming-from-geographically" id="toc-question-1-where-is-revenue-coming-from-geographically" class="nav-link" data-scroll-target="#question-1-where-is-revenue-coming-from-geographically">Question 1: Where is revenue coming from geographically?</a>
  <ul class="collapse">
  <li><a href="#exploratory-visualizations" id="toc-exploratory-visualizations" class="nav-link" data-scroll-target="#exploratory-visualizations">Exploratory Visualizations</a>
  <ul class="collapse">
  <li><a href="#total-revenue-by-country" id="toc-total-revenue-by-country" class="nav-link" data-scroll-target="#total-revenue-by-country">Total Revenue by Country</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#question-2-what-genres-or-artists-generate-the-most-income" id="toc-question-2-what-genres-or-artists-generate-the-most-income" class="nav-link" data-scroll-target="#question-2-what-genres-or-artists-generate-the-most-income">Question 2: What genres or artists generate the most income?</a></li>
  <li><a href="#question-3-how-many-customers-are-repeat-buyers" id="toc-question-3-how-many-customers-are-repeat-buyers" class="nav-link" data-scroll-target="#question-3-how-many-customers-are-repeat-buyers">Question 3: How many customers are repeat buyers?</a></li>
  <li><a href="#question-4.-how-do-sales-trends-evolve-over-time" id="toc-question-4.-how-do-sales-trends-evolve-over-time" class="nav-link" data-scroll-target="#question-4.-how-do-sales-trends-evolve-over-time">Question 4. How do sales trends evolve over time?</a></li>
  <li><a href="#bottom" id="toc-bottom" class="nav-link" data-scroll-target="#bottom">BOTTOM</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/corvidfox/corvidfox.github.io/blob/main/projects/draft.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/corvidfox/corvidfox.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SQL-Driven Business Intelligence Dashboard (Chinook ‘Digital Music Store’)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">SQL</div>
    <div class="quarto-category">R</div>
    <div class="quarto-category">Python</div>
    <div class="quarto-category">Dashboard</div>
    <div class="quarto-category">Data Analysis</div>
    <div class="quarto-category">Business Intelligence</div>
    <div class="quarto-category">Exploratory Analysis</div>
    <div class="quarto-category">Retail Analytics</div>
    <div class="quarto-category">Chinook</div>
    <div class="quarto-category">Short</div>
    <div class="quarto-category">DuckDB</div>
  </div>
  </div>

<div>
  <div class="description">
    This project explores the Chinook dataset — a mock digital music store — to uncover key business insights around revenue, customers, and performance. It combines SQL analysis with dashboard development to present findings visually.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Morrigan M. </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 30, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">June 30, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="project-overview" class="level1">
<h1>Project Overview</h1>
<ul>
<li><strong>Goal</strong>: Build a BI dashboard for a fictional digital media business.</li>
<li><strong>Focus</strong>: Revenue insights, customer analysis, business performance.</li>
<li><strong>Why it matters</strong>: Business stakeholders need quick, clear access to KPIs.</li>
</ul>
<section id="technology-stack" class="level2">
<h2 class="anchored" data-anchor-id="technology-stack">Technology Stack</h2>
<p>The following tools were used to merge, analyze, and present the data:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Tool</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SQL</td>
<td>Data transformation and KPIs</td>
</tr>
<tr class="even">
<td>DuckDB</td>
<td>Lightweight, embedded relational database</td>
</tr>
<tr class="odd">
<td>R + Shiny</td>
<td>Dashboard development (R-based)</td>
</tr>
<tr class="even">
<td>Python + Dash</td>
<td>Dashboard development (Python-based)</td>
</tr>
</tbody>
</table>
<p>The project demonstrates dashboard development using both R (Shiny) and Python (Dash) to showcase flexibility across ecosystems.</p>
<p>[NOTE TO SELF - DELETE ONCE REVISED: This is a work in progress. I plan to make a dashboard with R and one with Python, just to show I can do both. I will update this to reflect the final project once it’s done.]</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(duckdb)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pycountry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="business-questions" class="level2">
<h2 class="anchored" data-anchor-id="business-questions">Business Questions</h2>
<p>This project is designed to help answer the following business questions:</p>
<ol type="1">
<li><strong>Where is revenue coming from geographically?</strong></li>
<li><strong>What genres or artists generate the most income?</strong></li>
<li><strong>How many customers are repeat buyers?</strong></li>
<li><strong>How do sales trends evolve over time?</strong></li>
</ol>
</section>
</section>
<section id="data-exploration-schema-understanding" class="level1">
<h1>Data Exploration &amp; Schema Understanding</h1>
<p>The <a href="https://github.com/lerocha/chinook-database">Chinook Database</a> is a well documented, publicly available data set. The SQLite version of the data was downloaded and converted into a <a href="https://duckdb.org/">DuckDB</a> database for this project to take advantage of DuckDB’s speed and in-memory querying capabilities.</p>
<p>The Chinook Database simulates a digital music store, similar to platforms like iTunes. It includes tables for artists, albums, tracks, customers, invoices, employees, and more.</p>
<p>A diagram of the database schema was created with <a href="https://dbdiagram.io/home">dbdiagram</a>.</p>
<div class="light-content">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/project_imgs/chinook_schema_light.png" class="img-fluid figure-img" alt="A database schema diagram for the Chinook database."></p>
<figcaption>Chinook Database Schema</figcaption>
</figure>
</div>
</div>
<div class="dark-content">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../img/project_imgs/chinook_schema_dark.png" class="img-fluid figure-img" alt="A database schema diagram for the Chinook database."></p>
<figcaption>Chinook Database Schema</figcaption>
</figure>
</div>
</div>
<p>From this schema, key tables of interest were identified for each business question:</p>
<ol type="1">
<li><strong>Where is revenue coming from geographically?</strong></li>
</ol>
<ul>
<li><em>Key Tables</em>: <code>Invoice</code>, <code>Customer</code></li>
<li><em>Explanation</em>: The <code>Invoice</code> table records total sales and billing address information, which identifies where revenue is being billed geographically. <code>Customer</code> provides customer addressing, which may differ from billing location and allows for a more detailed geographic analysis.</li>
</ul>
<ol start="2" type="1">
<li><strong>What genres or artists generate the most income?</strong></li>
</ol>
<ul>
<li><em>Key Tables</em>: <code>InvoiceLine</code>, <code>Track</code>, <code>Artist</code>, <code>Genre</code></li>
<li><em>Explanation</em>: <code>InvoiceLine</code> records individual track purchases, including price and quantity. Joining to the <code>Track</code> table provides track-level metadata through further links to <code>Artist</code> and <code>Genre</code>, enabling revenue analysis by artist or genre.</li>
</ul>
<ol start="3" type="1">
<li><strong>How many customers are repeat buyers?</strong></li>
</ol>
<ul>
<li><em>Key Tables</em>: <code>Invoice</code>, <code>Customer</code></li>
<li><em>Explanation</em>: The <code>Customer</code> table identifies each buyer, while <code>Invoice</code> records all purchase transactions. Counting invoices per customer reveals how many made repeat purchases, offering insight into customer retention.</li>
</ul>
<ol start="4" type="1">
<li><strong>How do sales trends evolve over time?</strong></li>
</ol>
<ul>
<li><em>Key Tables</em>: <code>Invoice</code>, <code>InvoiceLine</code></li>
<li><em>Explanation</em>: The <code>Invoice</code> table includes invoice dates and total amounts, allowing for time-based trend analysis (e.g., monthly revenue). <code>InvoiceLine</code> can be joined for more granular insights, such as which tracks or genres are trending over specific time periods, or purchase volume trends.</li>
</ul>
<p>With the schema understood and key tables identified, the next step is to query the data using SQL and create exploratory R visualizations to begin answering the business questions.</p>
<section id="connection-and-validation" class="level2">
<h2 class="anchored" data-anchor-id="connection-and-validation">Connection and Validation</h2>
<p>A connection was made to the DuckDB database file.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>con_chinook <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbConnect</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  duckdb<span class="sc">::</span><span class="fu">duckdb</span>(), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dbdir =</span> <span class="st">"../data/chinook.duckdb"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">read_only =</span> <span class="cn">TRUE</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>con_chinook <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">"../data/chinook.duckdb"</span>, read_only <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>Initial exploration aimed to verify the expected data range and structure described in the documentation.</p>
<p>A query of date values in the <code>InvoiceDate</code> table confirmed that the data contained records with a date range from <code>2009-01-01</code> to <code>2013-12-22</code>.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show Code</summary>
<div class="code-with-filename-file">
<pre><strong>SQL</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get date range of Invoices</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">MIN</span>(i.InvoiceDate) <span class="kw">as</span> MinDate, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">MAX</span>(i.InvoiceDate) <span class="kw">as</span> MaxDate</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Invoice i;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">MinDate</th>
<th style="text-align: left;">MaxDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2009-01-01</td>
<td style="text-align: left;">2013-12-22</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>As expected, <code>InvoiceLine</code> and <code>Track</code> had the highest number of unique records, reflecting their one-to-many relationships with <code>Invoice</code> and <code>Album</code>, respectively. Metadata tables such as <code>Genre</code> and <code>MediaType</code> had fewer unique values.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show Code</summary>
<div class="code-with-filename-file">
<pre><strong>SQL</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get Number of Unique Key Values in Each Table</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Employees'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> EmployeeId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Employee</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Customers'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> Customerid) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Customer</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Invoices'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> InvoiceId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Invoice</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Invoice Lines'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> InvoiceLineId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> InvoiceLine</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Tracks'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> TrackId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Track</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Artists'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> ArtistId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Artist</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Albums'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> AlbumId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Album</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Genres'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> GenreId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Genre</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Media Types'</span> <span class="kw">AS</span> TableName,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> MediaTypeId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> MediaType</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Playlists'</span> <span class="kw">AS</span> TableName, </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> PlaylistId) <span class="kw">AS</span> UniqueKeys </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Playlist</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> UniqueKeys <span class="kw">DESC</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">TableName</th>
<th style="text-align: right;">UniqueKeys</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tracks</td>
<td style="text-align: right;">3503</td>
</tr>
<tr class="even">
<td style="text-align: left;">Invoice Lines</td>
<td style="text-align: right;">2240</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Invoices</td>
<td style="text-align: right;">412</td>
</tr>
<tr class="even">
<td style="text-align: left;">Albums</td>
<td style="text-align: right;">347</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Artists</td>
<td style="text-align: right;">275</td>
</tr>
<tr class="even">
<td style="text-align: left;">Customers</td>
<td style="text-align: right;">59</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Genres</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Playlists</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Employees</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Media Types</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>With structure confirmed, attention was turned towards the identified business questions.</p>
</section>
</section>
<section id="question-1-where-is-revenue-coming-from-geographically" class="level1">
<h1>Question 1: Where is revenue coming from geographically?</h1>
<p>Analysis of geographic revenue began with the country recorded in the <code>Invoice</code> table. This geographic value reflected where purchases were billed, which is often used as the default location reference for financial reporting.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show Code</summary>
<div class="code-with-filename-file">
<pre><strong>SQL</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Revenue by Country (Billing)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    i.BillingCountry, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(i.Total) <span class="kw">AS</span> TotalRevenue,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(i.Total)<span class="op">*</span><span class="fl">100.0</span> <span class="op">/</span> (<span class="kw">SELECT</span> <span class="fu">SUM</span>(Total) <span class="kw">from</span> Invoice), <span class="dv">2</span>) <span class="kw">AS</span> PercentGlobalRevenue,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> c.CustomerId) <span class="kw">AS</span> NumCustomers,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(i.Total) <span class="op">/</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> c.CustomerId), <span class="dv">2</span>) <span class="kw">AS</span> RevenuePerCustomer</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Customer c</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Invoice i <span class="kw">on</span> c.CustomerId <span class="op">==</span> i.CustomerId</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> i.BillingCountry</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sort Revenue (Highest to Lowest)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> TotalRevenue <span class="kw">DESC</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 25%">
<col style="width: 16%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">BillingCountry</th>
<th style="text-align: right;">TotalRevenue</th>
<th style="text-align: right;">PercentGlobalRevenue</th>
<th style="text-align: right;">NumCustomers</th>
<th style="text-align: right;">RevenuePerCustomer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">USA</td>
<td style="text-align: right;">523.06</td>
<td style="text-align: right;">22.46</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">40.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">Canada</td>
<td style="text-align: right;">303.96</td>
<td style="text-align: right;">13.05</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">37.99</td>
</tr>
<tr class="odd">
<td style="text-align: left;">France</td>
<td style="text-align: right;">195.10</td>
<td style="text-align: right;">8.38</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">39.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">190.10</td>
<td style="text-align: right;">8.16</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">38.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Germany</td>
<td style="text-align: right;">156.48</td>
<td style="text-align: right;">6.72</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">39.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">112.86</td>
<td style="text-align: right;">4.85</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">37.62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Czech Republic</td>
<td style="text-align: right;">90.24</td>
<td style="text-align: right;">3.88</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">45.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">Portugal</td>
<td style="text-align: right;">77.24</td>
<td style="text-align: right;">3.32</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">38.62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">India</td>
<td style="text-align: right;">75.26</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">37.63</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chile</td>
<td style="text-align: right;">46.62</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.62</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>The customer base is geographically uneven.</p>
<ul>
<li>The United States alone accounts for a quarter of global revenue (22.46%).</li>
<li>The top five countries (USA, Canada, France, Brazil, Germany) contribute over half (58.77%) of global revenue.</li>
</ul>
<p><strong>Opportunity</strong>: Expanding to underrepresented regions could be a growth opportunity, if demand can be identified and activated.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are different customer behavior patterns in each country.</p>
<ul>
<li>None of the top revenue-generating countries appear in the top five for <em>revenue-per-customer</em> (Chile, Hungary, Ireland, Czech Republic, Austria).</li>
<li>High total revenue countries likely have large but casual user bases.</li>
<li>High per-customer revenue countries likely reflect smaller but more valuable audiences..</li>
</ul>
<p><strong>Opportunities</strong>:</p>
<ul>
<li>High total revenue countries are ideal for <em>retention and upselling</em> strategies.</li>
<li>High per-customer revenue countries are ideal for <em>acquisition-focused</em> campaigns.</li>
</ul>
</div>
</div>
<p>However, the <code>Customer</code> table also contained a <code>Country</code> field. Differences between billing and customer country could reflect travel, gift purchases, or mismatched contact vs.&nbsp;billing addresses.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show Code</summary>
<div class="code-with-filename-file">
<pre><strong>SQL</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Total Revenue by Country (Customer)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    c.Country, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(i.Total) <span class="kw">AS</span> TotalRevenue,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(i.Total)<span class="op">*</span><span class="fl">100.0</span> <span class="op">/</span> (<span class="kw">SELECT</span> <span class="fu">SUM</span>(Total) <span class="kw">from</span> Invoice), <span class="dv">2</span>) <span class="kw">AS</span> PercentGlobalRevenue,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> c.CustomerId) <span class="kw">AS</span> NumCustomers,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ROUND</span>(<span class="fu">SUM</span>(i.Total) <span class="op">/</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> c.CustomerId), <span class="dv">2</span>) <span class="kw">AS</span> RevenuePerCustomer</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> Customer c</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> Invoice i <span class="kw">on</span> c.CustomerId <span class="op">==</span> i.CustomerId</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> c.Country</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sort Revenue (Highest to Lowest)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> TotalRevenue <span class="kw">DESC</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 25%">
<col style="width: 16%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Country</th>
<th style="text-align: right;">TotalRevenue</th>
<th style="text-align: right;">PercentGlobalRevenue</th>
<th style="text-align: right;">NumCustomers</th>
<th style="text-align: right;">RevenuePerCustomer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">USA</td>
<td style="text-align: right;">523.06</td>
<td style="text-align: right;">22.46</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">40.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">Canada</td>
<td style="text-align: right;">303.96</td>
<td style="text-align: right;">13.05</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">37.99</td>
</tr>
<tr class="odd">
<td style="text-align: left;">France</td>
<td style="text-align: right;">195.10</td>
<td style="text-align: right;">8.38</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">39.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">Brazil</td>
<td style="text-align: right;">190.10</td>
<td style="text-align: right;">8.16</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">38.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Germany</td>
<td style="text-align: right;">156.48</td>
<td style="text-align: right;">6.72</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">39.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">United Kingdom</td>
<td style="text-align: right;">112.86</td>
<td style="text-align: right;">4.85</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">37.62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Czech Republic</td>
<td style="text-align: right;">90.24</td>
<td style="text-align: right;">3.88</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">45.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">Portugal</td>
<td style="text-align: right;">77.24</td>
<td style="text-align: right;">3.32</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">38.62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">India</td>
<td style="text-align: right;">75.26</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">37.63</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chile</td>
<td style="text-align: right;">46.62</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">46.62</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>To identify any countries with mismatched revenue attribution, the aggregated views were joined and compared.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show Code</summary>
<div class="code-with-filename-file">
<pre><strong>SQL</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Rows with discrepancies in Revenue by Country</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- (Billing vs Customer)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Revenue by Invoice.BillingCountry</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> billing_country_revenue <span class="kw">AS</span> (</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        BillingCountry <span class="kw">AS</span> Country,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">SUM</span>(Total) <span class="kw">AS</span> Revenue_Billing</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> Invoice</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> BillingCountry</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Revenue by Customer Country (joined from Invoice.Customer)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>customer_country_revenue <span class="kw">AS</span> (</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        c.Country <span class="kw">AS</span> Country,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">SUM</span>(i.Total) <span class="kw">AS</span> Revenue_Customer</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> Invoice i</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">JOIN</span> Customer c <span class="kw">ON</span> i.CustomerId <span class="op">=</span> c.CustomerId</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> c.Country</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">-- Join the aggregations into a single table (by Country)</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">COALESCE</span>(b.Country, c.Country) <span class="kw">AS</span> Country,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    b.Revenue_Billing,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    c.Revenue_Customer</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> billing_country_revenue b</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="kw">FULL</span> <span class="kw">OUTER</span> <span class="kw">JOIN</span> customer_country_revenue c</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> b.Country <span class="op">=</span> c.Country</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">-- Select only rows where revenue differs by country source</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  b.Revenue_Billing <span class="kw">IS</span> <span class="kw">DISTINCT</span> <span class="kw">FROM</span> c.Revenue_Customer</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Country;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell-output-display">
<table class="caption-top">
<caption>0 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Country</th>
<th style="text-align: right;">Revenue_Billing</th>
<th style="text-align: right;">Revenue_Customer</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>Billing and customer country match exactly in this data set, indicating no divergence due to travel, gifting, or alternate addresses. This simplifies location-based analysis but may also reflect a limitation in the data set’s realism.</p>
</div>
</div>
<section id="exploratory-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-visualizations">Exploratory Visualizations</h2>
<p>In preparation for exploratory visualization generation, the data is retrieved using SQL queries and prepared in both R and Python.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SQL Queries</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Yearly Breakdown</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>res_yearly_df <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  con_chinook, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SELECT </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Get Country and Year for grouping</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">    i.BillingCountry as Country, </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="st">    YEAR(i.InvoiceDate) as Year,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Calculate Total Revenue</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="st">    SUM(i.Total) AS TotalRevenue,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Calculate % of Total/Global Revenue</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="st">    ROUND(SUM(i.Total)*100.0 / (SELECT SUM(Total) from Invoice), 2) AS PercentGlobalRevenue,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Get Number of Customers</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(DISTINCT c.CustomerId) AS NumCustomers,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Calculate Revenue per Customer</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="st">    ROUND(SUM(i.Total) / COUNT(DISTINCT c.CustomerId), 2) AS RevenuePerCustomer</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Customer c</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN Invoice i on c.CustomerId == i.CustomerId</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY i.BillingCountry, Year</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="st">-- Sort Revenue (Highest to Lowest)</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY Year, TotalRevenue DESC;"</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Total (all years)</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>res_agg_df <span class="ot">&lt;-</span> DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  con_chinook, </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SELECT </span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Get Country for grouping</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="st">    i.BillingCountry as Country,</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Set 'Year' to 'All' for grouping</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="st">    'All' AS Year,</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Calculate Total Revenue</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="st">    SUM(i.Total) AS TotalRevenue,</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Calculate % of Total/Global Revenue</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="st">    ROUND(SUM(i.Total)*100.0 / (SELECT SUM(Total) from Invoice), 2) AS PercentGlobalRevenue,</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Get Number of Customers</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="st">    COUNT(DISTINCT c.CustomerId) AS NumCustomers,</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="st">    -- Calculate Revenue per Customer</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="st">    ROUND(SUM(i.Total) / COUNT(DISTINCT c.CustomerId), 2) AS RevenuePerCustomer</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="st">FROM Customer c</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN Invoice i on c.CustomerId == i.CustomerId</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY i.BillingCountry,</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="st">-- Sort Revenue (Highest to Lowest)</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY Year, TotalRevenue DESC;"</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data frames in R</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>res_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  res_agg_df,</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  res_yearly_df <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Add ISO Country Codes</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">iso_alpha =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>      Country, </span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">origin =</span> <span class="st">'country.name'</span>, </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">destination =</span> <span class="st">'iso3c'</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Format Hover Text (&lt;b&gt;Country:&lt;/b&gt;&lt;br&gt; $TotalRevenue.##")</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_text =</span> <span class="fu">paste0</span>(</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;"</span>, Country, <span class="st">":&lt;/b&gt;&lt;br&gt; $"</span>,</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">formatC</span>(TotalRevenue, <span class="at">format =</span> <span class="st">'f'</span>, <span class="at">big.mark =</span><span class="st">",'"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Get vector of unique years (layers/traces) - order with "All" first.</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"All"</span>, <span class="fu">sort</span>(<span class="fu">unique</span>(res_yearly_df<span class="sc">$</span>Year)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SQL Queries</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Yearly Breakdown</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>res_yearly_df <span class="op">=</span> con_chinook.execute(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""SELECT </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Get Country and Year for grouping</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="st">      i.BillingCountry as Country, </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="st">      YEAR(i.InvoiceDate) as Year,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Calculate Total Revenue</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="st">      SUM(i.Total) AS TotalRevenue,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Calculate </span><span class="sc">% o</span><span class="st">f Total/Global Revenue</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="st">      ROUND(SUM(i.Total)*100.0 / (SELECT SUM(Total) from Invoice), 2) AS PercentGlobalRevenue,</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Get Number of Customers</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="st">      COUNT(DISTINCT c.CustomerId) AS NumCustomers,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Calculate Revenue per Customer</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="st">      ROUND(SUM(i.Total) / COUNT(DISTINCT c.CustomerId), 2) AS RevenuePerCustomer</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM Customer c</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN Invoice i on c.CustomerId == i.CustomerId</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY i.BillingCountry, Year</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="st">  -- Sort Revenue (Highest to Lowest)</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY Year, TotalRevenue DESC;"""</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  ).df()</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">## Total (all years)</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>res_agg_df <span class="op">=</span> con_chinook.execute(</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""SELECT </span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Get Country for grouping</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="st">      i.BillingCountry as Country,</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Set 'Year' to 'All' for grouping</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="st">      'All' AS Year,</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Calculate Total Revenue</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="st">      SUM(i.Total) AS TotalRevenue,</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Calculate </span><span class="sc">% o</span><span class="st">f Total/Global Revenue</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="st">      ROUND(SUM(i.Total)*100.0 / (SELECT SUM(Total) from Invoice), 2) AS PercentGlobalRevenue,</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Get Number of Customers</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="st">      COUNT(DISTINCT c.CustomerId) AS NumCustomers,</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="st">      -- Calculate Revenue per Customer</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="st">      ROUND(SUM(i.Total) / COUNT(DISTINCT c.CustomerId), 2) AS RevenuePerCustomer</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM Customer c</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="st">  JOIN Invoice i on c.CustomerId == i.CustomerId</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY i.BillingCountry,</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="st">  -- Sort Revenue (Highest to Lowest)</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY Year, TotalRevenue DESC;"""</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  ).df()</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data frames and ensure consistent types</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>res_df <span class="op">=</span> pd.concat([</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  res_agg_df,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  res_yearly_df.assign(Year<span class="op">=</span>res_yearly_df[<span class="st">'Year'</span>].astype(<span class="bu">str</span>))</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  ], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Add ISO Country Codes</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_iso_alpha3(country_name):</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a> <span class="cf">try</span>:</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> pycountry.countries.lookup(country_name).alpha_3</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a> <span class="cf">except</span> <span class="pp">LookupError</span>:</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>res_df[<span class="st">'iso_alpha'</span>] <span class="op">=</span> res_df[<span class="st">'Country'</span>].<span class="bu">apply</span>(get_iso_alpha3)</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique years (layers/traces) - order with "All" first.</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> [<span class="st">"All"</span>] <span class="op">+</span> <span class="bu">sorted</span>(res_df[res_df[<span class="st">'Year'</span>] <span class="op">!=</span> <span class="st">'All'</span>][<span class="st">'Year'</span>].unique().tolist())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<section id="total-revenue-by-country" class="level3">
<h3 class="anchored" data-anchor-id="total-revenue-by-country">Total Revenue by Country</h3>
<p>Total revenue per country across the entire data set was visualized with a Choropeth plot.</p>
<p>For best viewing experience, browser is recommended - optimization of these exploratory visualizations is limited.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format Hover Text (&lt;b&gt;Country:&lt;/b&gt;&lt;br&gt; $TotalRevenue.##")</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>res_df <span class="ot">&lt;-</span> res_df <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_text =</span> <span class="fu">paste0</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;"</span>, Country, <span class="st">":&lt;/b&gt;&lt;br&gt; $"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">formatC</span>(TotalRevenue, <span class="at">format =</span> <span class="st">'f'</span>, <span class="at">big.mark =</span><span class="st">",'"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get minimum and maximum values for TotalRevenue (Colorbar consistency)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>z_min_val <span class="ot">&lt;-</span> <span class="fu">min</span>(res_df<span class="sc">$</span>TotalRevenue, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>z_max_val <span class="ot">&lt;-</span> <span class="fu">max</span>(res_df<span class="sc">$</span>TotalRevenue, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plotly Choropleth</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> res_df,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">'choropleth'</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">locations =</span> <span class="sc">~</span>iso_alpha,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="sc">~</span>TotalRevenue,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set hover text to only display our desired, formatted output</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="sc">~</span>hover_text,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">frame =</span> <span class="sc">~</span>Year,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set minimum and maximum TotalRevenue values, for consistent scale</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">zmin =</span> z_min_val,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">zmax =</span> z_max_val,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Title Colorbar/Legend</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">colorbar =</span> <span class="fu">list</span>(</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Total Revenue (USD$)"</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Color-blind friendly color scale</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">colorscale =</span> <span class="st">"Viridis"</span>,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">reversescale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">showscale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Give national boundaries a dark gray outline</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">width =</span> <span class="fl">0.5</span>))</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Layout with animation controls</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">layout</span>(</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="st">"Total Revenue by Country &lt;br&gt; 2009-01-01 to 2013-12-22"</span>,</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.5</span>,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">xanchor =</span> <span class="st">"center"</span>,</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">18</span>)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">geo =</span> <span class="fu">list</span>(</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add a neat little frame around the world</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">showframe =</span> <span class="cn">TRUE</span>, </span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add coast lines - ensures countries that aren't in data are seen</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">showcoastlines =</span> <span class="cn">TRUE</span>, </span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Use natural earth projection</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">projection =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'natural earth'</span>)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">updatemenus =</span> <span class="fu">list</span>(</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"dropdown"</span>,</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">showactive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">buttons =</span> purrr<span class="sc">::</span><span class="fu">map</span>(years, <span class="cf">function</span>(yr) {</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"animate"</span>,</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>            <span class="at">args =</span> <span class="fu">list</span>(<span class="fu">list</span>(yr), <span class="fu">list</span>(<span class="at">mode =</span> <span class="st">"immediate"</span>, <span class="at">frame =</span> <span class="fu">list</span>(<span class="at">duration =</span> <span class="dv">0</span>, <span class="at">redraw =</span> <span class="cn">TRUE</span>))),</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> yr</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>        }),</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Positioning of dropdown menu</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.1</span>,</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fl">1.15</span>,</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">xanchor =</span> <span class="st">"left"</span>,</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>        <span class="at">yanchor =</span> <span class="st">"top"</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">t =</span> <span class="dv">80</span>)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>  plotly<span class="sc">::</span><span class="fu">animation_opts</span>(<span class="at">frame =</span> <span class="dv">1000</span>, <span class="at">transition =</span> <span class="dv">0</span>, <span class="at">redraw =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Display interactive plot</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d2faee58386c9b4ddd04" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d2faee58386c9b4ddd04">{"x":{"visdat":{"26a42b715c3":["function () ","plotlyVisDat"]},"cur_data":"26a42b715c3","attrs":{"26a42b715c3":{"locations":{},"z":{},"text":{},"hoverinfo":"text","zmin":0.98999999999999999,"zmax":523.06000000000029,"colorbar":{"title":"Total Revenue (USD$)"},"colorscale":"Viridis","reversescale":true,"showscale":true,"marker":{"line":{"color":"darkgrey","width":0.5}},"frame":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"choropleth"}},"layout":{"margin":{"b":40,"l":60,"t":80,"r":10},"title":{"text":"Total Revenue by Country <br> 2009-01-01 to 2013-12-22","x":0.5,"xanchor":"center","font":{"size":18}},"geo":{"showframe":true,"showcoastlines":true,"projection":{"type":"natural earth"}},"updatemenus":[{"type":"dropdown","showactive":true,"buttons":[{"method":"animate","args":[["All"],{"mode":"immediate","frame":{"duration":0,"redraw":true}}],"label":"All"},{"method":"animate","args":[["2009"],{"mode":"immediate","frame":{"duration":0,"redraw":true}}],"label":"2009"},{"method":"animate","args":[["2010"],{"mode":"immediate","frame":{"duration":0,"redraw":true}}],"label":"2010"},{"method":"animate","args":[["2011"],{"mode":"immediate","frame":{"duration":0,"redraw":true}}],"label":"2011"},{"method":"animate","args":[["2012"],{"mode":"immediate","frame":{"duration":0,"redraw":true}}],"label":"2012"},{"method":"animate","args":[["2013"],{"mode":"immediate","frame":{"duration":0,"redraw":true}}],"label":"2013"}],"x":0.10000000000000001,"y":1.1499999999999999,"xanchor":"left","yanchor":"top"},{"type":"buttons","direction":"right","showactive":false,"y":0,"x":0,"yanchor":"top","xanchor":"right","pad":{"t":60,"r":5},"buttons":[{"label":"Play","method":"animate","args":[null,{"fromcurrent":true,"mode":"immediate","transition":{"duration":0,"easing":"linear"},"frame":{"duration":1000,"redraw":true}}]}]}],"scene":{"zaxis":{"title":"TotalRevenue"}},"hovermode":"closest","showlegend":false,"sliders":[{"currentvalue":{"prefix":"Year: ","xanchor":"right","font":{"size":16,"color":"rgba(204,204,204,1)"}},"steps":[{"method":"animate","args":[["2009"],{"transition":{"duration":0,"easing":"linear"},"frame":{"duration":1000,"redraw":true},"mode":"immediate"}],"label":"2009","value":"2009"},{"method":"animate","args":[["2010"],{"transition":{"duration":0,"easing":"linear"},"frame":{"duration":1000,"redraw":true},"mode":"immediate"}],"label":"2010","value":"2010"},{"method":"animate","args":[["2011"],{"transition":{"duration":0,"easing":"linear"},"frame":{"duration":1000,"redraw":true},"mode":"immediate"}],"label":"2011","value":"2011"},{"method":"animate","args":[["2012"],{"transition":{"duration":0,"easing":"linear"},"frame":{"duration":1000,"redraw":true},"mode":"immediate"}],"label":"2012","value":"2012"},{"method":"animate","args":[["2013"],{"transition":{"duration":0,"easing":"linear"},"frame":{"duration":1000,"redraw":true},"mode":"immediate"}],"label":"2013","value":"2013"},{"method":"animate","args":[["All"],{"transition":{"duration":0,"easing":"linear"},"frame":{"duration":1000,"redraw":true},"mode":"immediate"}],"label":"All","value":"All"}],"visible":true,"pad":{"t":40}}],"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"Total Revenue (USD$)","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":"Viridis","showscale":true,"locations":["USA","CAN","DEU","BRA","FRA","GBR","CHL","POL","AUS","PRT","NOR","CZE","IND","NLD","FIN","BEL","IRL","SWE","DNK","ITA","AUT","ESP"],"z":[103.94999999999999,57.419999999999995,53.459999999999994,37.619999999999997,35.640000000000001,25.740000000000002,15.84,15.84,11.879999999999999,11.879999999999999,10.890000000000001,10.890000000000001,9.9000000000000004,8.9100000000000001,8.9100000000000001,6.9300000000000006,6.9300000000000006,5.9399999999999995,5.9399999999999995,1.98,1.98,0.98999999999999999],"text":["<b>USA:<\/b><br> $103.95","<b>Canada:<\/b><br> $57.42","<b>Germany:<\/b><br> $53.46","<b>Brazil:<\/b><br> $37.62","<b>France:<\/b><br> $35.64","<b>United Kingdom:<\/b><br> $25.74","<b>Chile:<\/b><br> $15.84","<b>Poland:<\/b><br> $15.84","<b>Australia:<\/b><br> $11.88","<b>Portugal:<\/b><br> $11.88","<b>Norway:<\/b><br> $10.89","<b>Czech Republic:<\/b><br> $10.89","<b>India:<\/b><br> $9.90","<b>Netherlands:<\/b><br> $8.91","<b>Finland:<\/b><br> $8.91","<b>Belgium:<\/b><br> $6.93","<b>Ireland:<\/b><br> $6.93","<b>Sweden:<\/b><br> $5.94","<b>Denmark:<\/b><br> $5.94","<b>Italy:<\/b><br> $1.98","<b>Austria:<\/b><br> $1.98","<b>Spain:<\/b><br> $0.99"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"zmin":0.98999999999999999,"zmax":523.06000000000029,"reversescale":true,"marker":{"line":{"color":"darkgrey","width":0.5}},"frame":"2009","type":"choropleth","visible":true}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"frames":[{"name":"2009","data":[{"colorbar":{"title":"Total Revenue (USD$)","ticklen":2},"colorscale":"Viridis","showscale":true,"locations":["USA","CAN","DEU","BRA","FRA","GBR","CHL","POL","AUS","PRT","NOR","CZE","IND","NLD","FIN","BEL","IRL","SWE","DNK","ITA","AUT","ESP"],"z":[103.94999999999999,57.419999999999995,53.459999999999994,37.619999999999997,35.640000000000001,25.740000000000002,15.84,15.84,11.879999999999999,11.879999999999999,10.890000000000001,10.890000000000001,9.9000000000000004,8.9100000000000001,8.9100000000000001,6.9300000000000006,6.9300000000000006,5.9399999999999995,5.9399999999999995,1.98,1.98,0.98999999999999999],"text":["<b>USA:<\/b><br> $103.95","<b>Canada:<\/b><br> $57.42","<b>Germany:<\/b><br> $53.46","<b>Brazil:<\/b><br> $37.62","<b>France:<\/b><br> $35.64","<b>United Kingdom:<\/b><br> $25.74","<b>Chile:<\/b><br> $15.84","<b>Poland:<\/b><br> $15.84","<b>Australia:<\/b><br> $11.88","<b>Portugal:<\/b><br> $11.88","<b>Norway:<\/b><br> $10.89","<b>Czech Republic:<\/b><br> $10.89","<b>India:<\/b><br> $9.90","<b>Netherlands:<\/b><br> $8.91","<b>Finland:<\/b><br> $8.91","<b>Belgium:<\/b><br> $6.93","<b>Ireland:<\/b><br> $6.93","<b>Sweden:<\/b><br> $5.94","<b>Denmark:<\/b><br> $5.94","<b>Italy:<\/b><br> $1.98","<b>Austria:<\/b><br> $1.98","<b>Spain:<\/b><br> $0.99"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"zmin":0.98999999999999999,"zmax":523.06000000000029,"reversescale":true,"marker":{"line":{"color":"darkgrey","width":0.5}},"frame":"2009","type":"choropleth","visible":true}],"traces":[0]},{"name":"2010","data":[{"colorbar":{"title":"Total Revenue (USD$)","ticklen":2},"colorscale":"Viridis","showscale":true,"locations":["USA","CAN","BRA","FRA","HUN","GBR","AUT","DEU","CHL","IND","ARG","ITA","CZE","POL","SWE","DNK","PRT","ESP","NLD","AUS"],"z":[102.97999999999999,76.259999999999991,41.600000000000001,39.599999999999994,32.75,30.690000000000001,27.77,25.740000000000002,17.91,17.829999999999998,11.879999999999999,10.890000000000001,9.9000000000000004,8.9100000000000001,7.9300000000000006,6.9300000000000006,6.9299999999999997,1.98,1.98,0.98999999999999999],"text":["<b>USA:<\/b><br> $102.98","<b>Canada:<\/b><br> $76.26","<b>Brazil:<\/b><br> $41.60","<b>France:<\/b><br> $39.60","<b>Hungary:<\/b><br> $32.75","<b>United Kingdom:<\/b><br> $30.69","<b>Austria:<\/b><br> $27.77","<b>Germany:<\/b><br> $25.74","<b>Chile:<\/b><br> $17.91","<b>India:<\/b><br> $17.83","<b>Argentina:<\/b><br> $11.88","<b>Italy:<\/b><br> $10.89","<b>Czech Republic:<\/b><br> $9.90","<b>Poland:<\/b><br> $8.91","<b>Sweden:<\/b><br> $7.93","<b>Denmark:<\/b><br> $6.93","<b>Portugal:<\/b><br> $6.93","<b>Spain:<\/b><br> $1.98","<b>Netherlands:<\/b><br> $1.98","<b>Australia:<\/b><br> $0.99"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"zmin":0.98999999999999999,"zmax":523.06000000000029,"reversescale":true,"marker":{"line":{"color":"darkgrey","width":0.5}},"frame":"2010","type":"choropleth","visible":true}],"traces":[0]},{"name":"2011","data":[{"colorbar":{"title":"Total Revenue (USD$)","ticklen":2},"colorscale":"Viridis","showscale":true,"locations":["USA","CAN","DEU","FRA","IRL","BEL","IND","ESP","BRA","NOR","GBR","FIN","NLD","CZE","PRT","CHL","AUS","ARG"],"z":[103.00999999999999,55.439999999999998,48.57,42.609999999999999,32.75,24.75,24.75,22.77,19.800000000000001,17.84,17.82,15.879999999999999,12.899999999999999,12.870000000000001,8.9100000000000001,5.9399999999999995,1.98,0.98999999999999999],"text":["<b>USA:<\/b><br> $103.01","<b>Canada:<\/b><br> $55.44","<b>Germany:<\/b><br> $48.57","<b>France:<\/b><br> $42.61","<b>Ireland:<\/b><br> $32.75","<b>Belgium:<\/b><br> $24.75","<b>India:<\/b><br> $24.75","<b>Spain:<\/b><br> $22.77","<b>Brazil:<\/b><br> $19.80","<b>Norway:<\/b><br> $17.84","<b>United Kingdom:<\/b><br> $17.82","<b>Finland:<\/b><br> $15.88","<b>Netherlands:<\/b><br> $12.90","<b>Czech Republic:<\/b><br> $12.87","<b>Portugal:<\/b><br> $8.91","<b>Chile:<\/b><br> $5.94","<b>Australia:<\/b><br> $1.98","<b>Argentina:<\/b><br> $0.99"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"zmin":0.98999999999999999,"zmax":523.06000000000029,"reversescale":true,"marker":{"line":{"color":"darkgrey","width":0.5}},"frame":"2011","type":"choropleth","visible":true}],"traces":[0]},{"name":"2012","data":[{"colorbar":{"title":"Total Revenue (USD$)","ticklen":2},"colorscale":"Viridis","showscale":true,"locations":["USA","BRA","CAN","FRA","PRT","SWE","AUS","CZE","DEU","ITA","DNK","POL","AUT","HUN","IND","GBR","NOR","CHL","NLD","FIN"],"z":[127.97999999999999,53.460000000000001,42.57,36.659999999999997,24.77,24.75,22.77,19.829999999999998,18.810000000000002,15.84,15.84,11.879999999999999,11.879999999999999,11.879999999999999,10.890000000000001,9.9000000000000004,8.9100000000000001,6.9300000000000006,0.98999999999999999,0.98999999999999999],"text":["<b>USA:<\/b><br> $127.98","<b>Brazil:<\/b><br> $53.46","<b>Canada:<\/b><br> $42.57","<b>France:<\/b><br> $36.66","<b>Portugal:<\/b><br> $24.77","<b>Sweden:<\/b><br> $24.75","<b>Australia:<\/b><br> $22.77","<b>Czech Republic:<\/b><br> $19.83","<b>Germany:<\/b><br> $18.81","<b>Italy:<\/b><br> $15.84","<b>Denmark:<\/b><br> $15.84","<b>Poland:<\/b><br> $11.88","<b>Austria:<\/b><br> $11.88","<b>Hungary:<\/b><br> $11.88","<b>India:<\/b><br> $10.89","<b>United Kingdom:<\/b><br> $9.90","<b>Norway:<\/b><br> $8.91","<b>Chile:<\/b><br> $6.93","<b>Netherlands:<\/b><br> $0.99","<b>Finland:<\/b><br> $0.99"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"zmin":0.98999999999999999,"zmax":523.06000000000029,"reversescale":true,"marker":{"line":{"color":"darkgrey","width":0.5}},"frame":"2012","type":"choropleth","visible":true}],"traces":[0]},{"name":"2013","data":[{"colorbar":{"title":"Total Revenue (USD$)","ticklen":2},"colorscale":"Viridis","showscale":true,"locations":["USA","CAN","FRA","BRA","CZE","GBR","PRT","ARG","NLD","FIN","IND","ESP","DEU","ITA","DNK","IRL","BEL","NOR","POL","AUT","HUN"],"z":[85.140000000000001,72.269999999999982,40.590000000000003,37.619999999999997,36.75,28.710000000000001,24.75,24.75,15.84,15.84,11.890000000000001,11.879999999999999,9.9000000000000004,8.9100000000000001,8.9100000000000001,5.9399999999999995,5.9399999999999995,1.98,0.98999999999999999,0.98999999999999999,0.98999999999999999],"text":["<b>USA:<\/b><br> $85.14","<b>Canada:<\/b><br> $72.27","<b>France:<\/b><br> $40.59","<b>Brazil:<\/b><br> $37.62","<b>Czech Republic:<\/b><br> $36.75","<b>United Kingdom:<\/b><br> $28.71","<b>Portugal:<\/b><br> $24.75","<b>Argentina:<\/b><br> $24.75","<b>Netherlands:<\/b><br> $15.84","<b>Finland:<\/b><br> $15.84","<b>India:<\/b><br> $11.89","<b>Spain:<\/b><br> $11.88","<b>Germany:<\/b><br> $9.90","<b>Italy:<\/b><br> $8.91","<b>Denmark:<\/b><br> $8.91","<b>Ireland:<\/b><br> $5.94","<b>Belgium:<\/b><br> $5.94","<b>Norway:<\/b><br> $1.98","<b>Poland:<\/b><br> $0.99","<b>Austria:<\/b><br> $0.99","<b>Hungary:<\/b><br> $0.99"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"zmin":0.98999999999999999,"zmax":523.06000000000029,"reversescale":true,"marker":{"line":{"color":"darkgrey","width":0.5}},"frame":"2013","type":"choropleth","visible":true}],"traces":[0]},{"name":"All","data":[{"colorbar":{"title":"Total Revenue (USD$)","ticklen":2},"colorscale":"Viridis","showscale":true,"locations":["USA","CAN","FRA","BRA","DEU","GBR","CZE","PRT","IND","CHL","HUN","IRL","AUT","FIN","NLD","NOR","SWE","DNK","ITA","POL","ARG","AUS","BEL","ESP"],"z":[523.06000000000029,303.95999999999992,195.09999999999994,190.09999999999997,156.47999999999999,112.85999999999999,90.240000000000009,77.239999999999981,75.259999999999991,46.619999999999997,45.619999999999997,45.619999999999997,42.619999999999997,41.620000000000005,40.619999999999997,39.619999999999997,38.620000000000005,37.620000000000005,37.620000000000005,37.620000000000005,37.620000000000005,37.620000000000005,37.619999999999997,37.619999999999997],"text":["<b>USA:<\/b><br> $523.06","<b>Canada:<\/b><br> $303.96","<b>France:<\/b><br> $195.10","<b>Brazil:<\/b><br> $190.10","<b>Germany:<\/b><br> $156.48","<b>United Kingdom:<\/b><br> $112.86","<b>Czech Republic:<\/b><br> $90.24","<b>Portugal:<\/b><br> $77.24","<b>India:<\/b><br> $75.26","<b>Chile:<\/b><br> $46.62","<b>Hungary:<\/b><br> $45.62","<b>Ireland:<\/b><br> $45.62","<b>Austria:<\/b><br> $42.62","<b>Finland:<\/b><br> $41.62","<b>Netherlands:<\/b><br> $40.62","<b>Norway:<\/b><br> $39.62","<b>Sweden:<\/b><br> $38.62","<b>Denmark:<\/b><br> $37.62","<b>Italy:<\/b><br> $37.62","<b>Poland:<\/b><br> $37.62","<b>Argentina:<\/b><br> $37.62","<b>Australia:<\/b><br> $37.62","<b>Belgium:<\/b><br> $37.62","<b>Spain:<\/b><br> $37.62"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"zmin":0.98999999999999999,"zmax":523.06000000000029,"reversescale":true,"marker":{"line":{"color":"darkgrey","width":0.5}},"frame":"All","type":"choropleth","visible":true}],"traces":[0]}],"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify hover text</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>res_df[<span class="st">'hover_text'</span>] <span class="op">=</span> res_df.<span class="bu">apply</span>( <span class="op">\</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">lambda</span> row: <span class="ss">f"&lt;b&gt;</span><span class="sc">{</span>row[<span class="st">'Country'</span>]<span class="sc">}</span><span class="ss">&lt;/b&gt;&lt;br&gt; $</span><span class="sc">{</span>row[<span class="st">'TotalRevenue'</span>]<span class="sc">:.2f}</span><span class="ss">"</span>, axis <span class="op">=</span> <span class="dv">1</span> <span class="op">\</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get maximum and minimum TotalRevenue values (consistent scale)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>z_min_val <span class="op">=</span> res_df[<span class="st">'TotalRevenue'</span>].<span class="bu">min</span>()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>z_max_val <span class="op">=</span> res_df[<span class="st">'TotalRevenue'</span>].<span class="bu">max</span>()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create frames (one per year, and aggregate)</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>frames <span class="op">=</span> []</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  df_year <span class="op">=</span> res_df[res_df[<span class="st">'Year'</span>] <span class="op">==</span> year]</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  frames.append(go.Frame(</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> <span class="bu">str</span>(year),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> [go.Choropleth(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>      locations <span class="op">=</span> df_year[<span class="st">'iso_alpha'</span>],</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>      z <span class="op">=</span> df_year[<span class="st">'TotalRevenue'</span>],</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>      zmin <span class="op">=</span> z_min_val,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>      zmax <span class="op">=</span> z_max_val,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>      text <span class="op">=</span> df_year[<span class="st">'hover_text'</span>],</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>      hoverinfo <span class="op">=</span> <span class="st">'text'</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Color-blind friendly color scale (reversed: darker with higher revenues)</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>      colorscale <span class="op">=</span> <span class="st">'Viridis_r'</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Give national boundaries a dark grey outline</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>      marker <span class="op">=</span> <span class="bu">dict</span>(line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'darkgrey'</span>, width<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    )]</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="co"># First frame (initial state)</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>init_df <span class="op">=</span> res_df[res_df[<span class="st">'Year'</span>] <span class="op">==</span> <span class="st">'All'</span>]</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plotly Choropleth</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  data<span class="op">=</span>[go.Choropleth(</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        locations<span class="op">=</span>init_df[<span class="st">'iso_alpha'</span>],</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>        z<span class="op">=</span>init_df[<span class="st">'TotalRevenue'</span>],</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>init_df[<span class="st">'hover_text'</span>],</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        hoverinfo<span class="op">=</span><span class="st">'text'</span>,</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Color-blind friendly color scale (reversed: darker with higher revenues)</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        colorscale<span class="op">=</span><span class="st">'Viridis_r'</span>,</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        zmin<span class="op">=</span>z_min_val,</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>        zmax<span class="op">=</span>z_max_val,</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Give national boundaries a dark grey outline</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'darkgrey'</span>, width<span class="op">=</span><span class="fl">0.5</span>)),</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Title Colorbar/Legend</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        colorbar<span class="op">=</span><span class="bu">dict</span>(title<span class="op">=</span><span class="st">'Total Revenue (USD$)'</span>)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    )],</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    frames<span class="op">=</span>frames</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Format Layout with Animation Controls</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  title <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">"Total Revenue by Country &lt;br&gt; 2009-01-01 to 2013-12-22"</span>,</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    xanchor <span class="op">=</span> <span class="st">'center'</span>,</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    font <span class="op">=</span> <span class="bu">dict</span>(size<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>  margin<span class="op">=</span><span class="bu">dict</span>(t<span class="op">=</span><span class="dv">80</span>),</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Frame and view</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  geo <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show countries and boundaries</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    showcountries <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Give national boundaries a dark gray outline</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    countrycolor<span class="op">=</span><span class="st">"darkgrey"</span>,</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add coast lines - ensure scountries that aren't in data are seen</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    showcoastlines <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>    coastlinecolor <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  Ad a neat little frame around the world</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>    showframe <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    framecolor <span class="op">=</span> <span class="st">"black"</span>,</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use natural earth projection</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    projection_type <span class="op">=</span> <span class="st">"natural earth"</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Buttons/Menus</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>  updatemenus <span class="op">=</span> [<span class="bu">dict</span>(</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">## Play/Pause</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First button active by default (yr == "All")</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>        <span class="bu">type</span> <span class="op">=</span> <span class="st">"buttons"</span>,</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> <span class="st">"left"</span>,</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        showactive <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        xanchor <span class="op">=</span> <span class="st">"left"</span>,</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>        yanchor <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>        pad <span class="op">=</span> <span class="bu">dict</span>(r <span class="op">=</span> <span class="dv">10</span>, t <span class="op">=</span> <span class="dv">70</span>),</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>        buttons <span class="op">=</span> [<span class="bu">dict</span>(</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>          label <span class="op">=</span> <span class="st">"Play"</span>,</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>          method <span class="op">=</span> <span class="st">"animate"</span>,</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>          args <span class="op">=</span> [<span class="va">None</span>, {</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>            <span class="st">"frame"</span>: {<span class="st">"duration"</span>: <span class="dv">1000</span>, <span class="st">"redraw"</span>: <span class="va">True</span>},</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>            <span class="st">"fromcurrent"</span>: <span class="va">True</span>,</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>            <span class="st">"transition"</span>: {<span class="st">"duration"</span>: <span class="dv">300</span>, <span class="st">"easing"</span>: <span class="st">"quadratic-in-out"</span>}</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>          }]</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>        ), <span class="bu">dict</span>(</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>          label <span class="op">=</span> <span class="st">"Pause"</span>,</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>          method <span class="op">=</span> <span class="st">"animate"</span>,</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>          args<span class="op">=</span>[[<span class="va">None</span>], {<span class="st">"frame"</span>: {<span class="st">"duration"</span>: <span class="dv">0</span>}, <span class="st">"mode"</span>: <span class="st">"immediate"</span>}] </span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>          )] </span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>      )] <span class="op">+</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>  <span class="co">## Year Dropdown Menu</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>    [<span class="bu">dict</span>(</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>      <span class="bu">type</span><span class="op">=</span><span class="st">"dropdown"</span>,</span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="fl">1.15</span>,</span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>      xanchor<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>      yanchor<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>      showactive<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>      buttons<span class="op">=</span>[<span class="bu">dict</span>(</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="bu">str</span>(year),</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>        method<span class="op">=</span><span class="st">"animate"</span>,</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>        args<span class="op">=</span>[</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>            [<span class="bu">str</span>(year)],</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>            {<span class="st">"mode"</span>: <span class="st">"immediate"</span>,</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>             <span class="st">"frame"</span>: {<span class="st">"duration"</span>: <span class="dv">0</span>, <span class="st">"redraw"</span>: <span class="va">True</span>},</span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>             <span class="st">"transition"</span>: {<span class="st">"duration"</span>: <span class="dv">0</span>}}</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>    ) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>  )],</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>  sliders <span class="op">=</span> [<span class="bu">dict</span>(</span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>      active <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Positioning of slider menu</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="op">-</span><span class="fl">0.2</span>,</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>      <span class="bu">len</span> <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>      xanchor <span class="op">=</span> <span class="st">"left"</span>,</span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>      yanchor <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>      pad <span class="op">=</span> <span class="bu">dict</span>(t<span class="op">=</span> <span class="dv">30</span>, b<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>      currentvalue <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>        visible <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a>        prefix <span class="op">=</span> <span class="st">"Year: "</span>,</span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a>        xanchor <span class="op">=</span> <span class="st">"right"</span>,</span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>        font <span class="op">=</span> <span class="bu">dict</span>(size<span class="op">=</span><span class="dv">14</span>, color <span class="op">=</span> <span class="st">"#666"</span>)</span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a>    steps <span class="op">=</span> [<span class="bu">dict</span>(</span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>      method <span class="op">=</span> <span class="st">'animate'</span>,</span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>      args <span class="op">=</span>[[<span class="bu">str</span>(year)], {</span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>        <span class="st">"mode"</span>: <span class="st">"immediate"</span>,</span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>        <span class="st">"frame"</span>: {<span class="st">"duration"</span>: <span class="dv">1000</span>, <span class="st">"redraw"</span>: <span class="va">True</span>},</span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>        <span class="st">"transition"</span>: {<span class="st">"duration"</span>: <span class="dv">300</span>}</span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>        }],</span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="bu">str</span>(year) </span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>      ) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>    )] </span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Display interactive plot</span></span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-3.0.1.min.js" integrity="sha256-oy6Be7Eh6eiQFs5M7oXuPxxm9qbJXEtTpfSI93dW16Q=" crossorigin="anonymous"></script>                <div id="9db82c0b-6cfb-479f-98eb-a7125eb45577" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                window.PLOTLYENV=window.PLOTLYENV || {};                                if (document.getElementById("9db82c0b-6cfb-479f-98eb-a7125eb45577")) {                    Plotly.newPlot(                        "9db82c0b-6cfb-479f-98eb-a7125eb45577",                        [{"colorbar":{"title":{"text":"Total Revenue (USD$)"}},"colorscale":[[0.0,"#fde725"],[0.1111111111111111,"#b5de2b"],[0.2222222222222222,"#6ece58"],[0.3333333333333333,"#35b779"],[0.4444444444444444,"#1f9e89"],[0.5555555555555556,"#26828e"],[0.6666666666666666,"#31688e"],[0.7777777777777778,"#3e4989"],[0.8888888888888888,"#482878"],[1.0,"#440154"]],"hoverinfo":"text","locations":["USA","CAN","FRA","BRA","DEU","GBR","CZE","PRT","IND","CHL","HUN","IRL","AUT","FIN","NLD","NOR","SWE","DNK","AUS","ITA","POL","ARG","ESP","BEL"],"marker":{"line":{"color":"darkgrey","width":0.5}},"text":["\u003cb\u003eUSA\u003c\u002fb\u003e\u003cbr\u003e $523.06","\u003cb\u003eCanada\u003c\u002fb\u003e\u003cbr\u003e $303.96","\u003cb\u003eFrance\u003c\u002fb\u003e\u003cbr\u003e $195.10","\u003cb\u003eBrazil\u003c\u002fb\u003e\u003cbr\u003e $190.10","\u003cb\u003eGermany\u003c\u002fb\u003e\u003cbr\u003e $156.48","\u003cb\u003eUnited Kingdom\u003c\u002fb\u003e\u003cbr\u003e $112.86","\u003cb\u003eCzech Republic\u003c\u002fb\u003e\u003cbr\u003e $90.24","\u003cb\u003ePortugal\u003c\u002fb\u003e\u003cbr\u003e $77.24","\u003cb\u003eIndia\u003c\u002fb\u003e\u003cbr\u003e $75.26","\u003cb\u003eChile\u003c\u002fb\u003e\u003cbr\u003e $46.62","\u003cb\u003eHungary\u003c\u002fb\u003e\u003cbr\u003e $45.62","\u003cb\u003eIreland\u003c\u002fb\u003e\u003cbr\u003e $45.62","\u003cb\u003eAustria\u003c\u002fb\u003e\u003cbr\u003e $42.62","\u003cb\u003eFinland\u003c\u002fb\u003e\u003cbr\u003e $41.62","\u003cb\u003eNetherlands\u003c\u002fb\u003e\u003cbr\u003e $40.62","\u003cb\u003eNorway\u003c\u002fb\u003e\u003cbr\u003e $39.62","\u003cb\u003eSweden\u003c\u002fb\u003e\u003cbr\u003e $38.62","\u003cb\u003eDenmark\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eAustralia\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eItaly\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003ePoland\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eArgentina\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eSpain\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eBelgium\u003c\u002fb\u003e\u003cbr\u003e $37.62"],"z":{"dtype":"f8","bdata":"F65H4XpYgECOwvUoXP9yQDEzMzMzY2hAMjMzMzPDZ0CPwvUoXI9jQNajcD0KN1xAkML1KFyPVkCOwvUoXE9TQHA9Ctej0FJAj8L1KFxPR0CPwvUoXM9GQI\u002fC9Shcz0ZAj8L1KFxPRUCQwvUoXM9EQI\u002fC9ShcT0RAj8L1KFzPQ0CQwvUoXE9DQJDC9Shcz0JAkML1KFzPQkCQwvUoXM9CQJDC9Shcz0JAkML1KFzPQkCPwvUoXM9CQI\u002fC9Shcz0JA"},"zmax":523.0600000000003,"zmin":0.99,"type":"choropleth"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermap":[{"type":"scattermap","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"title":{"font":{"size":18},"text":"Total Revenue by Country \u003cbr\u003e 2009-01-01 to 2013-12-22","x":0.5,"xanchor":"center"},"margin":{"t":80},"geo":{"projection":{"type":"natural earth"},"showcountries":true,"countrycolor":"darkgrey","showcoastlines":true,"coastlinecolor":"gray","showframe":true,"framecolor":"black"},"updatemenus":[{"buttons":[{"args":[null,{"frame":{"duration":1000,"redraw":true},"fromcurrent":true,"transition":{"duration":300,"easing":"quadratic-in-out"}}],"label":"Play","method":"animate"},{"args":[[null],{"frame":{"duration":0},"mode":"immediate"}],"label":"Pause","method":"animate"}],"direction":"left","pad":{"r":10,"t":70},"showactive":false,"type":"buttons","x":0,"xanchor":"left","y":0,"yanchor":"bottom"},{"buttons":[{"args":[["All"],{"mode":"immediate","frame":{"duration":0,"redraw":true},"transition":{"duration":0}}],"label":"All","method":"animate"},{"args":[["2009"],{"mode":"immediate","frame":{"duration":0,"redraw":true},"transition":{"duration":0}}],"label":"2009","method":"animate"},{"args":[["2010"],{"mode":"immediate","frame":{"duration":0,"redraw":true},"transition":{"duration":0}}],"label":"2010","method":"animate"},{"args":[["2011"],{"mode":"immediate","frame":{"duration":0,"redraw":true},"transition":{"duration":0}}],"label":"2011","method":"animate"},{"args":[["2012"],{"mode":"immediate","frame":{"duration":0,"redraw":true},"transition":{"duration":0}}],"label":"2012","method":"animate"},{"args":[["2013"],{"mode":"immediate","frame":{"duration":0,"redraw":true},"transition":{"duration":0}}],"label":"2013","method":"animate"}],"showactive":true,"type":"dropdown","x":0.1,"xanchor":"left","y":1.15,"yanchor":"top"}],"sliders":[{"active":0,"currentvalue":{"font":{"color":"#666","size":14},"prefix":"Year: ","visible":true,"xanchor":"right"},"len":0.8,"pad":{"b":10,"t":30},"steps":[{"args":[["All"],{"mode":"immediate","frame":{"duration":1000,"redraw":true},"transition":{"duration":300}}],"label":"All","method":"animate"},{"args":[["2009"],{"mode":"immediate","frame":{"duration":1000,"redraw":true},"transition":{"duration":300}}],"label":"2009","method":"animate"},{"args":[["2010"],{"mode":"immediate","frame":{"duration":1000,"redraw":true},"transition":{"duration":300}}],"label":"2010","method":"animate"},{"args":[["2011"],{"mode":"immediate","frame":{"duration":1000,"redraw":true},"transition":{"duration":300}}],"label":"2011","method":"animate"},{"args":[["2012"],{"mode":"immediate","frame":{"duration":1000,"redraw":true},"transition":{"duration":300}}],"label":"2012","method":"animate"},{"args":[["2013"],{"mode":"immediate","frame":{"duration":1000,"redraw":true},"transition":{"duration":300}}],"label":"2013","method":"animate"}],"x":0.1,"xanchor":"left","y":-0.2,"yanchor":"bottom"}]},                        {"responsive": true}                    ).then(function(){
                            Plotly.addFrames('9db82c0b-6cfb-479f-98eb-a7125eb45577', [{"data":[{"colorscale":[[0.0,"#fde725"],[0.1111111111111111,"#b5de2b"],[0.2222222222222222,"#6ece58"],[0.3333333333333333,"#35b779"],[0.4444444444444444,"#1f9e89"],[0.5555555555555556,"#26828e"],[0.6666666666666666,"#31688e"],[0.7777777777777778,"#3e4989"],[0.8888888888888888,"#482878"],[1.0,"#440154"]],"hoverinfo":"text","locations":["USA","CAN","FRA","BRA","DEU","GBR","CZE","PRT","IND","CHL","HUN","IRL","AUT","FIN","NLD","NOR","SWE","DNK","AUS","ITA","POL","ARG","ESP","BEL"],"marker":{"line":{"color":"darkgrey","width":0.5}},"text":["\u003cb\u003eUSA\u003c\u002fb\u003e\u003cbr\u003e $523.06","\u003cb\u003eCanada\u003c\u002fb\u003e\u003cbr\u003e $303.96","\u003cb\u003eFrance\u003c\u002fb\u003e\u003cbr\u003e $195.10","\u003cb\u003eBrazil\u003c\u002fb\u003e\u003cbr\u003e $190.10","\u003cb\u003eGermany\u003c\u002fb\u003e\u003cbr\u003e $156.48","\u003cb\u003eUnited Kingdom\u003c\u002fb\u003e\u003cbr\u003e $112.86","\u003cb\u003eCzech Republic\u003c\u002fb\u003e\u003cbr\u003e $90.24","\u003cb\u003ePortugal\u003c\u002fb\u003e\u003cbr\u003e $77.24","\u003cb\u003eIndia\u003c\u002fb\u003e\u003cbr\u003e $75.26","\u003cb\u003eChile\u003c\u002fb\u003e\u003cbr\u003e $46.62","\u003cb\u003eHungary\u003c\u002fb\u003e\u003cbr\u003e $45.62","\u003cb\u003eIreland\u003c\u002fb\u003e\u003cbr\u003e $45.62","\u003cb\u003eAustria\u003c\u002fb\u003e\u003cbr\u003e $42.62","\u003cb\u003eFinland\u003c\u002fb\u003e\u003cbr\u003e $41.62","\u003cb\u003eNetherlands\u003c\u002fb\u003e\u003cbr\u003e $40.62","\u003cb\u003eNorway\u003c\u002fb\u003e\u003cbr\u003e $39.62","\u003cb\u003eSweden\u003c\u002fb\u003e\u003cbr\u003e $38.62","\u003cb\u003eDenmark\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eAustralia\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eItaly\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003ePoland\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eArgentina\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eSpain\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eBelgium\u003c\u002fb\u003e\u003cbr\u003e $37.62"],"z":{"dtype":"f8","bdata":"F65H4XpYgECOwvUoXP9yQDEzMzMzY2hAMjMzMzPDZ0CPwvUoXI9jQNajcD0KN1xAkML1KFyPVkCOwvUoXE9TQHA9Ctej0FJAj8L1KFxPR0CPwvUoXM9GQI\u002fC9Shcz0ZAj8L1KFxPRUCQwvUoXM9EQI\u002fC9ShcT0RAj8L1KFzPQ0CQwvUoXE9DQJDC9Shcz0JAkML1KFzPQkCQwvUoXM9CQJDC9Shcz0JAkML1KFzPQkCPwvUoXM9CQI\u002fC9Shcz0JA"},"zmax":523.0600000000003,"zmin":0.99,"type":"choropleth"}],"name":"All"},{"data":[{"colorscale":[[0.0,"#fde725"],[0.1111111111111111,"#b5de2b"],[0.2222222222222222,"#6ece58"],[0.3333333333333333,"#35b779"],[0.4444444444444444,"#1f9e89"],[0.5555555555555556,"#26828e"],[0.6666666666666666,"#31688e"],[0.7777777777777778,"#3e4989"],[0.8888888888888888,"#482878"],[1.0,"#440154"]],"hoverinfo":"text","locations":["USA","CAN","DEU","BRA","FRA","GBR","CHL","POL","AUS","PRT","CZE","NOR","IND","NLD","FIN","IRL","BEL","SWE","DNK","ITA","AUT","ESP"],"marker":{"line":{"color":"darkgrey","width":0.5}},"text":["\u003cb\u003eUSA\u003c\u002fb\u003e\u003cbr\u003e $103.95","\u003cb\u003eCanada\u003c\u002fb\u003e\u003cbr\u003e $57.42","\u003cb\u003eGermany\u003c\u002fb\u003e\u003cbr\u003e $53.46","\u003cb\u003eBrazil\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eFrance\u003c\u002fb\u003e\u003cbr\u003e $35.64","\u003cb\u003eUnited Kingdom\u003c\u002fb\u003e\u003cbr\u003e $25.74","\u003cb\u003eChile\u003c\u002fb\u003e\u003cbr\u003e $15.84","\u003cb\u003ePoland\u003c\u002fb\u003e\u003cbr\u003e $15.84","\u003cb\u003eAustralia\u003c\u002fb\u003e\u003cbr\u003e $11.88","\u003cb\u003ePortugal\u003c\u002fb\u003e\u003cbr\u003e $11.88","\u003cb\u003eCzech Republic\u003c\u002fb\u003e\u003cbr\u003e $10.89","\u003cb\u003eNorway\u003c\u002fb\u003e\u003cbr\u003e $10.89","\u003cb\u003eIndia\u003c\u002fb\u003e\u003cbr\u003e $9.90","\u003cb\u003eNetherlands\u003c\u002fb\u003e\u003cbr\u003e $8.91","\u003cb\u003eFinland\u003c\u002fb\u003e\u003cbr\u003e $8.91","\u003cb\u003eIreland\u003c\u002fb\u003e\u003cbr\u003e $6.93","\u003cb\u003eBelgium\u003c\u002fb\u003e\u003cbr\u003e $6.93","\u003cb\u003eSweden\u003c\u002fb\u003e\u003cbr\u003e $5.94","\u003cb\u003eDenmark\u003c\u002fb\u003e\u003cbr\u003e $5.94","\u003cb\u003eItaly\u003c\u002fb\u003e\u003cbr\u003e $1.98","\u003cb\u003eAustria\u003c\u002fb\u003e\u003cbr\u003e $1.98","\u003cb\u003eSpain\u003c\u002fb\u003e\u003cbr\u003e $0.99"],"z":{"dtype":"f8","bdata":"zMzMzMz8WUD1KFyPwrVMQHoUrkfhukpAj8L1KFzPQkBSuB6F69FBQD4K16NwvTlArkfhehSuL0CuR+F6FK4vQML1KFyPwidAwvUoXI\u002fCJ0BI4XoUrsclQEjhehSuxyVAzczMzMzMI0BSuB6F69EhQFK4HoXr0SFAuR6F61G4G0C5HoXrUbgbQML1KFyPwhdAwvUoXI\u002fCF0CuR+F6FK7\u002fP65H4XoUrv8\u002frkfhehSu7z8="},"zmax":523.0600000000003,"zmin":0.99,"type":"choropleth"}],"name":"2009"},{"data":[{"colorscale":[[0.0,"#fde725"],[0.1111111111111111,"#b5de2b"],[0.2222222222222222,"#6ece58"],[0.3333333333333333,"#35b779"],[0.4444444444444444,"#1f9e89"],[0.5555555555555556,"#26828e"],[0.6666666666666666,"#31688e"],[0.7777777777777778,"#3e4989"],[0.8888888888888888,"#482878"],[1.0,"#440154"]],"hoverinfo":"text","locations":["USA","CAN","BRA","FRA","HUN","GBR","AUT","DEU","CHL","IND","ARG","ITA","CZE","POL","SWE","DNK","PRT","NLD","ESP","AUS"],"marker":{"line":{"color":"darkgrey","width":0.5}},"text":["\u003cb\u003eUSA\u003c\u002fb\u003e\u003cbr\u003e $102.98","\u003cb\u003eCanada\u003c\u002fb\u003e\u003cbr\u003e $76.26","\u003cb\u003eBrazil\u003c\u002fb\u003e\u003cbr\u003e $41.60","\u003cb\u003eFrance\u003c\u002fb\u003e\u003cbr\u003e $39.60","\u003cb\u003eHungary\u003c\u002fb\u003e\u003cbr\u003e $32.75","\u003cb\u003eUnited Kingdom\u003c\u002fb\u003e\u003cbr\u003e $30.69","\u003cb\u003eAustria\u003c\u002fb\u003e\u003cbr\u003e $27.77","\u003cb\u003eGermany\u003c\u002fb\u003e\u003cbr\u003e $25.74","\u003cb\u003eChile\u003c\u002fb\u003e\u003cbr\u003e $17.91","\u003cb\u003eIndia\u003c\u002fb\u003e\u003cbr\u003e $17.83","\u003cb\u003eArgentina\u003c\u002fb\u003e\u003cbr\u003e $11.88","\u003cb\u003eItaly\u003c\u002fb\u003e\u003cbr\u003e $10.89","\u003cb\u003eCzech Republic\u003c\u002fb\u003e\u003cbr\u003e $9.90","\u003cb\u003ePoland\u003c\u002fb\u003e\u003cbr\u003e $8.91","\u003cb\u003eSweden\u003c\u002fb\u003e\u003cbr\u003e $7.93","\u003cb\u003eDenmark\u003c\u002fb\u003e\u003cbr\u003e $6.93","\u003cb\u003ePortugal\u003c\u002fb\u003e\u003cbr\u003e $6.93","\u003cb\u003eNetherlands\u003c\u002fb\u003e\u003cbr\u003e $1.98","\u003cb\u003eSpain\u003c\u002fb\u003e\u003cbr\u003e $1.98","\u003cb\u003eAustralia\u003c\u002fb\u003e\u003cbr\u003e $0.99"],"z":{"dtype":"f8","bdata":"HoXrUbi+WUBwPQrXoxBTQM3MzMzMzERAzMzMzMzMQ0AAAAAAAGBAQHE9CtejsD5AhetRuB7FO0A+CtejcL05QClcj8L16DFAFK5H4XrUMUDC9Shcj8InQEjhehSuxyVAzczMzMzMI0BSuB6F69EhQLkehetRuB9AuR6F61G4G0C4HoXrUbgbQK5H4XoUrv8\u002frkfhehSu\u002fz+uR+F6FK7vPw=="},"zmax":523.0600000000003,"zmin":0.99,"type":"choropleth"}],"name":"2010"},{"data":[{"colorscale":[[0.0,"#fde725"],[0.1111111111111111,"#b5de2b"],[0.2222222222222222,"#6ece58"],[0.3333333333333333,"#35b779"],[0.4444444444444444,"#1f9e89"],[0.5555555555555556,"#26828e"],[0.6666666666666666,"#31688e"],[0.7777777777777778,"#3e4989"],[0.8888888888888888,"#482878"],[1.0,"#440154"]],"hoverinfo":"text","locations":["USA","CAN","DEU","FRA","IRL","BEL","IND","ESP","BRA","NOR","GBR","FIN","NLD","CZE","PRT","CHL","AUS","ARG"],"marker":{"line":{"color":"darkgrey","width":0.5}},"text":["\u003cb\u003eUSA\u003c\u002fb\u003e\u003cbr\u003e $103.01","\u003cb\u003eCanada\u003c\u002fb\u003e\u003cbr\u003e $55.44","\u003cb\u003eGermany\u003c\u002fb\u003e\u003cbr\u003e $48.57","\u003cb\u003eFrance\u003c\u002fb\u003e\u003cbr\u003e $42.61","\u003cb\u003eIreland\u003c\u002fb\u003e\u003cbr\u003e $32.75","\u003cb\u003eBelgium\u003c\u002fb\u003e\u003cbr\u003e $24.75","\u003cb\u003eIndia\u003c\u002fb\u003e\u003cbr\u003e $24.75","\u003cb\u003eSpain\u003c\u002fb\u003e\u003cbr\u003e $22.77","\u003cb\u003eBrazil\u003c\u002fb\u003e\u003cbr\u003e $19.80","\u003cb\u003eNorway\u003c\u002fb\u003e\u003cbr\u003e $17.84","\u003cb\u003eUnited Kingdom\u003c\u002fb\u003e\u003cbr\u003e $17.82","\u003cb\u003eFinland\u003c\u002fb\u003e\u003cbr\u003e $15.88","\u003cb\u003eNetherlands\u003c\u002fb\u003e\u003cbr\u003e $12.90","\u003cb\u003eCzech Republic\u003c\u002fb\u003e\u003cbr\u003e $12.87","\u003cb\u003ePortugal\u003c\u002fb\u003e\u003cbr\u003e $8.91","\u003cb\u003eChile\u003c\u002fb\u003e\u003cbr\u003e $5.94","\u003cb\u003eAustralia\u003c\u002fb\u003e\u003cbr\u003e $1.98","\u003cb\u003eArgentina\u003c\u002fb\u003e\u003cbr\u003e $0.99"],"z":{"dtype":"f8","bdata":"cD0K16PAWUC4HoXrUbhLQClcj8L1SEhArkfhehRORUAAAAAAAGBAQAAAAAAAwDhAAAAAAADAOECF61G4HsU2QM3MzMzMzDNA16NwPQrXMUBSuB6F69ExQML1KFyPwi9AzMzMzMzMKUA+CtejcL0pQFK4HoXr0SFAwvUoXI\u002fCF0CuR+F6FK7\u002fP65H4XoUru8\u002f"},"zmax":523.0600000000003,"zmin":0.99,"type":"choropleth"}],"name":"2011"},{"data":[{"colorscale":[[0.0,"#fde725"],[0.1111111111111111,"#b5de2b"],[0.2222222222222222,"#6ece58"],[0.3333333333333333,"#35b779"],[0.4444444444444444,"#1f9e89"],[0.5555555555555556,"#26828e"],[0.6666666666666666,"#31688e"],[0.7777777777777778,"#3e4989"],[0.8888888888888888,"#482878"],[1.0,"#440154"]],"hoverinfo":"text","locations":["USA","BRA","CAN","FRA","PRT","SWE","AUS","CZE","DEU","ITA","DNK","HUN","POL","AUT","IND","GBR","NOR","CHL","NLD","FIN"],"marker":{"line":{"color":"darkgrey","width":0.5}},"text":["\u003cb\u003eUSA\u003c\u002fb\u003e\u003cbr\u003e $127.98","\u003cb\u003eBrazil\u003c\u002fb\u003e\u003cbr\u003e $53.46","\u003cb\u003eCanada\u003c\u002fb\u003e\u003cbr\u003e $42.57","\u003cb\u003eFrance\u003c\u002fb\u003e\u003cbr\u003e $36.66","\u003cb\u003ePortugal\u003c\u002fb\u003e\u003cbr\u003e $24.77","\u003cb\u003eSweden\u003c\u002fb\u003e\u003cbr\u003e $24.75","\u003cb\u003eAustralia\u003c\u002fb\u003e\u003cbr\u003e $22.77","\u003cb\u003eCzech Republic\u003c\u002fb\u003e\u003cbr\u003e $19.83","\u003cb\u003eGermany\u003c\u002fb\u003e\u003cbr\u003e $18.81","\u003cb\u003eItaly\u003c\u002fb\u003e\u003cbr\u003e $15.84","\u003cb\u003eDenmark\u003c\u002fb\u003e\u003cbr\u003e $15.84","\u003cb\u003eHungary\u003c\u002fb\u003e\u003cbr\u003e $11.88","\u003cb\u003ePoland\u003c\u002fb\u003e\u003cbr\u003e $11.88","\u003cb\u003eAustria\u003c\u002fb\u003e\u003cbr\u003e $11.88","\u003cb\u003eIndia\u003c\u002fb\u003e\u003cbr\u003e $10.89","\u003cb\u003eUnited Kingdom\u003c\u002fb\u003e\u003cbr\u003e $9.90","\u003cb\u003eNorway\u003c\u002fb\u003e\u003cbr\u003e $8.91","\u003cb\u003eChile\u003c\u002fb\u003e\u003cbr\u003e $6.93","\u003cb\u003eNetherlands\u003c\u002fb\u003e\u003cbr\u003e $0.99","\u003cb\u003eFinland\u003c\u002fb\u003e\u003cbr\u003e $0.99"],"z":{"dtype":"f8","bdata":"HoXrUbj+X0B7FK5H4bpKQClcj8L1SEVAFK5H4XpUQkCF61G4HsU4QAAAAAAAwDhAhetRuB7FNkAUrkfhetQzQJDC9ShczzJArkfhehSuL0CuR+F6FK4vQML1KFyPwidAwvUoXI\u002fCJ0DC9Shcj8InQEjhehSuxyVAzczMzMzMI0BSuB6F69EhQLkehetRuBtArkfhehSu7z+uR+F6FK7vPw=="},"zmax":523.0600000000003,"zmin":0.99,"type":"choropleth"}],"name":"2012"},{"data":[{"colorscale":[[0.0,"#fde725"],[0.1111111111111111,"#b5de2b"],[0.2222222222222222,"#6ece58"],[0.3333333333333333,"#35b779"],[0.4444444444444444,"#1f9e89"],[0.5555555555555556,"#26828e"],[0.6666666666666666,"#31688e"],[0.7777777777777778,"#3e4989"],[0.8888888888888888,"#482878"],[1.0,"#440154"]],"hoverinfo":"text","locations":["USA","CAN","FRA","BRA","CZE","GBR","ARG","PRT","NLD","FIN","IND","ESP","DEU","ITA","DNK","BEL","IRL","NOR","POL","HUN","AUT"],"marker":{"line":{"color":"darkgrey","width":0.5}},"text":["\u003cb\u003eUSA\u003c\u002fb\u003e\u003cbr\u003e $85.14","\u003cb\u003eCanada\u003c\u002fb\u003e\u003cbr\u003e $72.27","\u003cb\u003eFrance\u003c\u002fb\u003e\u003cbr\u003e $40.59","\u003cb\u003eBrazil\u003c\u002fb\u003e\u003cbr\u003e $37.62","\u003cb\u003eCzech Republic\u003c\u002fb\u003e\u003cbr\u003e $36.75","\u003cb\u003eUnited Kingdom\u003c\u002fb\u003e\u003cbr\u003e $28.71","\u003cb\u003eArgentina\u003c\u002fb\u003e\u003cbr\u003e $24.75","\u003cb\u003ePortugal\u003c\u002fb\u003e\u003cbr\u003e $24.75","\u003cb\u003eNetherlands\u003c\u002fb\u003e\u003cbr\u003e $15.84","\u003cb\u003eFinland\u003c\u002fb\u003e\u003cbr\u003e $15.84","\u003cb\u003eIndia\u003c\u002fb\u003e\u003cbr\u003e $11.89","\u003cb\u003eSpain\u003c\u002fb\u003e\u003cbr\u003e $11.88","\u003cb\u003eGermany\u003c\u002fb\u003e\u003cbr\u003e $9.90","\u003cb\u003eItaly\u003c\u002fb\u003e\u003cbr\u003e $8.91","\u003cb\u003eDenmark\u003c\u002fb\u003e\u003cbr\u003e $8.91","\u003cb\u003eBelgium\u003c\u002fb\u003e\u003cbr\u003e $5.94","\u003cb\u003eIreland\u003c\u002fb\u003e\u003cbr\u003e $5.94","\u003cb\u003eNorway\u003c\u002fb\u003e\u003cbr\u003e $1.98","\u003cb\u003ePoland\u003c\u002fb\u003e\u003cbr\u003e $0.99","\u003cb\u003eHungary\u003c\u002fb\u003e\u003cbr\u003e $0.99","\u003cb\u003eAustria\u003c\u002fb\u003e\u003cbr\u003e $0.99"],"z":{"dtype":"f8","bdata":"KVyPwvVIVUDgehSuRxFSQOxRuB6FS0RAj8L1KFzPQkAAAAAAAGBCQPYoXI\u002fCtTxAAAAAAADAOEAAAAAAAMA4QK5H4XoUri9ArkfhehSuL0BI4XoUrscnQML1KFyPwidAzczMzMzMI0BSuB6F69EhQFK4HoXr0SFAwvUoXI\u002fCF0DC9Shcj8IXQK5H4XoUrv8\u002frkfhehSu7z+uR+F6FK7vP65H4XoUru8\u002f"},"zmax":523.0600000000003,"zmin":0.99,"type":"choropleth"}],"name":"2013"}]);
                        }).then(function(){
                            Plotly.animate('9db82c0b-6cfb-479f-98eb-a7125eb45577', null);
                        })                };            </script>        </div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>The customer base is consistently geographically uneven.</p>
<ul>
<li>Revenue trends remain flat overall.</li>
<li>North America and Brazil consistently drive the highest revenues, indicating strong market presence and sustained demand.</li>
<li>India and parts of Central Europe maintain low but steady revenue, suggesting a stable (though modest) consumer base that may respond well to targeted growth strategies.</li>
<li>Australia showed signs of growth until 2013, after which revenue dropped to zero — this may reflect market exit, operational changes, or demand saturation.</li>
<li>Other parts of South America and Europe show sporadic revenue, possibly tied to one-time purchases or minimal customer engagement.</li>
</ul>
<p><strong>Opportunities</strong>:</p>
<ul>
<li>There is untapped potential in underrepresented regions. If market demand can be properly assessed and activated — through localized marketing, partnerships, or product adaptation — these regions could represent growth markets.</li>
<li>South America and Europe may benefit from customer acquisition and retention strategies.</li>
<li>Australia may be a strong case-study: understanding why Australia stopped producing revenue may identify key vulnerabilities that might translate to other markets.</li>
</ul>
</div>
</div>
</section>
</section>
</section>
<section id="question-2-what-genres-or-artists-generate-the-most-income" class="level1">
<h1>Question 2: What genres or artists generate the most income?</h1>
<ul>
<li><strong>Key Tables</strong>: <code>InvoiceLine</code>, <code>Track</code>, <code>Artist</code>, <code>Genre</code></li>
<li><strong>Explanation</strong>: <code>InvoiceLine</code> provides data relating to individual unit sales. Links between <code>Track</code>, <code>Artist</code>, and <code>Genre</code> provide additional details, such as artist name and genre, characterizing these unit sales.</li>
</ul>
</section>
<section id="question-3-how-many-customers-are-repeat-buyers" class="level1">
<h1>Question 3: How many customers are repeat buyers?</h1>
<ul>
<li><strong>Key Tables</strong>: <code>Invoice</code>, <code>Customer</code>, <code>InvoiceLine</code></li>
<li><strong>Explanation</strong>: <code>Customer</code> provides key customer data. Links to <code>Invoice</code> provide sales frequency information linked to each <code>Customer</code>, which may be further broken down to individual units or cost-per-unit with links to <code>InvoiceLine</code>.</li>
</ul>
</section>
<section id="question-4.-how-do-sales-trends-evolve-over-time" class="level1">
<h1>Question 4. How do sales trends evolve over time?</h1>
<ul>
<li><strong>Key Tables</strong>: <code>Invoice</code>, <code>InvoiceLine</code>, <code>Customer</code></li>
<li><strong>Explanation</strong>: <code>Invoice</code> provides sales data, including date of sale and revenue. This data may be further broken down to individual units or cost-per-unit with links to <code>InvoiceLine</code>. Further characterization may be done with links to <code>Customer</code> or other tables linked to <code>InvoiceLine</code>.</li>
</ul>
</section>
<section id="bottom" class="level1">
<h1>BOTTOM</h1>
<p>Disconnect from the database.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>DBI<span class="sc">::</span><span class="fu">dbDisconnect</span>(con_chinook)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conn_chinook.close()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/corvidfox/corvidfox.github.io/blob/main/projects/draft.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/corvidfox/corvidfox.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>